<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Which Prompt I Need</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: '#39ff14', // Il verde fluo richiesto
                        dark: '#050505', // Nero profondo
                        card: '#111111', // Nero leggermente più chiaro per le card
                    },
                    fontFamily: {
                        mono: ['"Space Mono"', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Scrollbar personalizzata stile terminale */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #39ff14; border-radius: 4px; }
        
        body { font-family: 'Space Mono', monospace; }
        
        /* Effetto glow per le card */
        .prompt-card:hover {
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
            border-color: #39ff14;
        }

        /* Stile per le variabili [TESTO] */
        .variable-highlight {
            background-color: rgba(57, 255, 20, 0.2);
            color: #39ff14;
            padding: 0 4px;
            border-radius: 2px;
            font-weight: bold;
            border: 1px solid #39ff14;
        }
    </style>
</head>
<body class="bg-dark text-neon overflow-hidden h-screen flex flex-col">

    <header class="h-16 border-b border-neon/30 flex items-center px-6 bg-dark z-20 shrink-0">
        <h1 class="text-xl font-bold tracking-tighter mr-8 border-r border-neon/30 pr-6">WHICH_PROMPT_I_NEED_</h1>
        <nav id="alias-container" class="flex space-x-4 overflow-x-auto no-scrollbar"></nav>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 border-r border-neon/30 p-6 flex flex-col gap-8 bg-dark shrink-0 overflow-y-auto">
            
            <div>
                <label class="text-xs text-neon/70 mb-2 block">> SEARCH_DATABASE</label>
                <input type="text" id="search-input" placeholder="Cerca parole chiave..." 
                    class="w-full bg-card border border-neon/50 text-neon p-2 text-sm focus:outline-none focus:border-neon focus:ring-1 focus:ring-neon placeholder-neon/30">
            </div>

            <div>
                <label class="text-xs text-neon/70 mb-2 block">> DIFFICULTY_LEVEL</label>
                <div class="flex flex-col gap-2" id="difficulty-filters">
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Facile" class="accent-neon bg-dark border-neon diff-checkbox" checked>
                        <span>[1] Facile</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Medio" class="accent-neon bg-dark border-neon diff-checkbox" checked>
                        <span>[2] Medio</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Difficile" class="accent-neon bg-dark border-neon diff-checkbox" checked>
                        <span>[3] Difficile</span>
                    </label>
                </div>
            </div>

            <div class="mt-auto text-xs text-neon/40">
                <p>SYSTEM STATUS: ONLINE</p>
                <p>V 1.0.0</p>
            </div>
        </aside>

        <main class="flex-1 p-8 overflow-y-auto relative" id="main-scroll">
            <div id="prompts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </main>
    </div>

    <div id="prompt-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-card border border-neon w-full max-w-2xl max-h-[90vh] flex flex-col shadow-[0_0_50px_rgba(57,255,20,0.1)] relative">
            
            <div class="flex justify-between items-center p-4 border-b border-neon/30">
                <h3 id="modal-title" class="text-xl font-bold">TITLE_HERE</h3>
                <button id="close-modal" class="text-neon hover:text-white hover:rotate-90 transition-transform">
                    [X] CHIUDI
                </button>
            </div>

            <div class="p-6 overflow-y-auto font-mono text-sm leading-relaxed text-gray-300">
                <p id="modal-desc" class="text-neon/60 mb-4 text-xs uppercase tracking-widest"></p>
                
                <div class="bg-black border border-neon/30 p-4 rounded relative group">
                    <p id="modal-text" class="whitespace-pre-wrap"></p> </div>
            </div>

            <div class="p-4 border-t border-neon/30 flex justify-end gap-4 bg-card">
                <button id="copy-btn" class="bg-neon text-black px-6 py-2 font-bold hover:bg-white hover:scale-105 transition-all flex items-center gap-2">
                    <span>COPIA_PROMPT</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let allPrompts = [];
        let currentAlias = 'ALL';

        // Mappa per ordinamento difficoltà
        const difficultyWeight = {
            'Facile': 1,
            'Medio': 2,
            'Difficile': 3
        };

        // Caricamento dati
        async function loadPrompts() {
            try {
                const response = await fetch('prompts.json');
                allPrompts = await response.json();
                
                // Ordina per difficoltà di default
                allPrompts.sort((a, b) => difficultyWeight[a.difficolta] - difficultyWeight[b.difficolta]);

                initApp();
            } catch (error) {
                console.error("Errore caricamento JSON:", error);
                document.getElementById('prompts-grid').innerHTML = `<div class="text-red-500">ERROR: DATABASE NOT FOUND (prompts.json missing)</div>`;
            }
        }

        function initApp() {
            renderAliases();
            renderPrompts();
            setupEventListeners();
        }

        // Genera i tab in alto
        function renderAliases() {
            const aliases = ['ALL', ...new Set(allPrompts.map(p => p.alias))];
            const container = document.getElementById('alias-container');
            
            container.innerHTML = aliases.map(alias => `
                <button 
                    onclick="setAlias('${alias}')"
                    class="px-4 py-1 border border-neon/30 hover:bg-neon hover:text-black transition-colors ${currentAlias === alias ? 'bg-neon text-black font-bold' : 'text-neon'}"
                >
                    ${alias.toUpperCase()}
                </button>
            `).join('');
        }

        window.setAlias = (alias) => {
            currentAlias = alias;
            renderAliases(); // Per aggiornare lo stile attivo
            renderPrompts();
        };

        // Gestione Variabili [NOME]
        function formatPromptText(text) {
            // Regex: trova tutto ciò che è tra quadre [] e lo avvolge in uno span
            return text.replace(/\[(.*?)\]/g, '<span class="variable-highlight">[$1]</span>');
        }

        function renderPrompts() {
            const grid = document.getElementById('prompts-grid');
            const searchText = document.getElementById('search-input').value.toLowerCase();
            
            // Leggi quali checkbox difficoltà sono attive
            const checkedDifficulties = Array.from(document.querySelectorAll('.diff-checkbox:checked')).map(cb => cb.value);

            // Filtra
            const filtered = allPrompts.filter(p => {
                const matchAlias = currentAlias === 'ALL' || p.alias === currentAlias;
                const matchSearch = p.titolo.toLowerCase().includes(searchText) || p.testo.toLowerCase().includes(searchText) || p.tags.includes(searchText);
                const matchDiff = checkedDifficulties.includes(p.difficolta);
                return matchAlias && matchSearch && matchDiff;
            });

            grid.innerHTML = filtered.map((p, index) => `
                <div class="prompt-card bg-card border border-neon/30 p-5 flex flex-col justify-between cursor-pointer transition-all h-64 relative group"
                     onclick="openModal(${p.id || index})"> <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs bg-neon/10 text-neon px-2 py-0.5 border border-neon/30">${p.alias}</span>
                            <span class="text-xs ${p.difficolta === 'Difficile' ? 'text-red-400' : 'text-neon/60'}">Lvl.${difficultyWeight[p.difficolta]}</span>
                        </div>
                        <h3 class="text-lg font-bold leading-tight mb-2 group-hover:underline decoration-neon decoration-2">${p.titolo}</h3>
                        <p class="text-xs text-gray-400 line-clamp-3 font-sans opacity-80">${p.testo.substring(0, 100)}...</p>
                    </div>

                    <div class="mt-4 flex justify-between items-center text-xs text-neon/50">
                        <span>#${p.tags.split(',')[0]}</span>
                        <span class="group-hover:translate-x-1 transition-transform">APRI_TERMINALE -></span>
                    </div>
                </div>
            `).join('');
        }

        // Logica Filtri
        function setupEventListeners() {
            document.getElementById('search-input').addEventListener('input', renderPrompts);
            document.querySelectorAll('.diff-checkbox').forEach(cb => {
                cb.addEventListener('change', renderPrompts);
            });
        }

        // --- MODAL LOGIC ---
        
        let currentPromptTextRaw = ""; // Per la copia pulita

        window.openModal = (index) => {
            // Se usiamo l'index filtrato attenzione, meglio cercare nell'array originale se hai ID.
            // Qui semplifico usando l'oggetto filtrato, ma per sicurezza nel rendering reale passo l'oggetto o un ID univoco.
            // Dato che filtro, l'index del loop non corrisponde all'array originale.
            // FIX: Cerchiamo l'oggetto nell'array filtrato? No, meglio passare l'oggetto intero o usare ID. 
            // In questo esempio base, per semplicità, ricalcolo l'oggetto basandomi sul rendering ma il modo migliore è:
            
            // 1. Trovare il prompt corretto.
            // Se nel JSON non hai ID, usiamo il titolo come chiave (o aggiungiamo ID al JSON).
            // Per ora recuperiamo dal render click.
            
            // Trick rapido: quando renderizzo passo l'indice dell'array *filtrato*? No.
            // Cerchiamo nell'array `allPrompts` quello che corrisponde.
            
            // SOLUZIONE MIGLIORE: Aggiungo dinamicamente un ID temporaneo al caricamento se non c'è.
            const prompt = allPrompts[index] || allPrompts.find(p => p.id == index); 
            // Nota: nel loadPrompts dovresti fare: allPrompts.forEach((p,i) => p.id = i); 
            
            if(!prompt) return;

            document.getElementById('modal-title').innerText = prompt.titolo;
            document.getElementById('modal-desc').innerText = `ALIAS: ${prompt.alias} | DIFF: ${prompt.difficolta} | TAGS: ${prompt.tags}`;
            
            // Inserisci HTML formattato con variabili evidenziate
            document.getElementById('modal-text').innerHTML = formatPromptText(prompt.testo);
            
            currentPromptTextRaw = prompt.testo; // Salvo testo puro per copia
            
            const modal = document.getElementById('prompt-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        // Aggiungi ID al load
        const _originalLoad = loadPrompts;
        loadPrompts = async () => {
            await _originalLoad(); 
            // Sovrascrivo per assegnare ID univoci per il modale
            allPrompts.forEach((p, i) => p.id = i);
            renderPrompts(); // Re-render iniziale
        }

        document.getElementById('close-modal').onclick = () => {
            const modal = document.getElementById('prompt-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        // Copia negli appunti
        document.getElementById('copy-btn').onclick = () => {
            navigator.clipboard.writeText(currentPromptTextRaw).then(() => {
                const btn = document.getElementById('copy-btn');
                const originalText = btn.innerHTML;
                
                btn.classList.replace('bg-neon', 'bg-white');
                btn.innerHTML = '<span>COPIATO!</span>';
                
                setTimeout(() => {
                    btn.classList.replace('bg-white', 'bg-neon');
                    btn.innerHTML = originalText;
                }, 2000);
            });
        };

        // Avvio
        loadPrompts();

    </script>
</body>
</html>