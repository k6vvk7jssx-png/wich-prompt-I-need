<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Which Prompt I Need</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: '#39ff14', // Il verde fluo richiesto
                        dark: '#050505', // Nero profondo
                        card: '#111111', // Nero leggermente più chiaro per le card
                    },
                    fontFamily: {
                        mono: ['"Space Mono"', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Scrollbar personalizzata stile terminale */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #39ff14; border-radius: 4px; }
        
        body { font-family: 'Space Mono', monospace; }
        
        /* Effetto glow per le card */
        .prompt-card:hover {
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
            border-color: #39ff14;
        }

        /* Stile per le variabili [TESTO] */
        .variable-highlight {
            background-color: rgba(57, 255, 20, 0.2);
            color: #39ff14;
            padding: 0 4px;
            border-radius: 2px;
            font-weight: bold;
            border: 1px solid #39ff14;
        }

        /* Nascondi scrollbar orizzontale per i menu su mobile */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-dark text-neon h-auto md:h-screen flex flex-col overflow-x-hidden md:overflow-hidden">

    <header class="sticky top-0 md:relative h-16 border-b border-neon/30 flex items-center px-4 md:px-6 bg-dark z-30 shrink-0 w-full shadow-lg md:shadow-none">
        <h1 class="text-sm md:text-xl font-bold tracking-tighter mr-4 border-r border-neon/30 pr-4 whitespace-nowrap">WHICH_PROMPT_</h1>
        <nav id="alias-container" class="flex space-x-2 overflow-x-auto no-scrollbar w-full items-center"></nav>
    </header>

    <div class="flex flex-col md:flex-row flex-1 overflow-hidden h-full">
        
        <aside class="w-full md:w-64 border-b md:border-b-0 md:border-r border-neon/30 p-4 md:p-6 flex flex-col gap-4 md:gap-8 bg-dark shrink-0 overflow-y-auto h-auto md:h-full z-20">
            
            <div>
                <label class="text-xs text-neon/70 mb-2 block">> SEARCH_DATABASE</label>
                <input type="text" id="search-input" placeholder="Cerca..." 
                    class="w-full bg-card border border-neon/50 text-neon p-2 text-sm focus:outline-none focus:border-neon focus:ring-1 focus:ring-neon placeholder-neon/30 rounded-none">
            </div>

            <div>
                <label class="text-xs text-neon/70 mb-2 block">> DIFFICULTY</label>
                <div class="flex flex-row md:flex-col gap-4 md:gap-2 flex-wrap" id="difficulty-filters">
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Facile" class="accent-neon bg-dark border-neon diff-checkbox w-4 h-4" checked>
                        <span class="text-sm">[1] Facile</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Medio" class="accent-neon bg-dark border-neon diff-checkbox w-4 h-4" checked>
                        <span class="text-sm">[2] Medio</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer hover:text-white">
                        <input type="checkbox" value="Difficile" class="accent-neon bg-dark border-neon diff-checkbox w-4 h-4" checked>
                        <span class="text-sm">[3] Difficile</span>
                    </label>
                </div>
            </div>

            <div class="hidden md:block mt-auto text-xs text-neon/40">
                <p>SYSTEM STATUS: ONLINE</p>
                <p>V 1.1.0 (Mobile)</p>
            </div>
        </aside>

        <main class="flex-1 p-4 md:p-8 overflow-y-auto relative h-full bg-dark" id="main-scroll">
            <div id="prompts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20 md:pb-0">
                </div>
        </main>
    </div>

    <div id="prompt-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-card border border-neon w-full max-w-2xl max-h-[80vh] flex flex-col shadow-[0_0_50px_rgba(57,255,20,0.1)] relative rounded-none">
            
            <div class="flex justify-between items-center p-4 border-b border-neon/30 bg-card">
                <h3 id="modal-title" class="text-lg md:text-xl font-bold truncate pr-4">TITLE</h3>
                <button id="close-modal" class="text-neon hover:text-white p-2 text-xl font-bold">
                    X
                </button>
            </div>

            <div class="p-4 md:p-6 overflow-y-auto font-mono text-xs md:text-sm leading-relaxed text-gray-300">
                <p id="modal-desc" class="text-neon/60 mb-4 text-[10px] md:text-xs uppercase tracking-widest break-words"></p>
                
                <div class="bg-black border border-neon/30 p-3 md:p-4 relative group overflow-x-auto">
                    <p id="modal-text" class="whitespace-pre-wrap"></p> </div>
            </div>

            <div class="p-4 border-t border-neon/30 flex justify-end gap-4 bg-card shrink-0">
                <button id="copy-btn" class="w-full md:w-auto bg-neon text-black px-6 py-3 md:py-2 font-bold hover:bg-white transition-all flex items-center justify-center gap-2 text-sm uppercase">
                    <span>COPIA_PROMPT</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let allPrompts = [];
        let currentAlias = 'ALL';

        const difficultyWeight = {
            'Facile': 1,
            'Medio': 2,
            'Difficile': 3
        };

        async function loadPrompts() {
            try {
                // Aggiungiamo un parametro casuale per evitare la cache del browser quando aggiorni il JSON
                const response = await fetch('prompts.json?v=' + new Date().getTime());
                allPrompts = await response.json();
                
                // Assegna ID se mancano e ordina
                allPrompts.forEach((p, i) => { if(!p.id) p.id = i; });
                allPrompts.sort((a, b) => difficultyWeight[a.difficolta] - difficultyWeight[b.difficolta]);

                initApp();
            } catch (error) {
                console.error("Errore:", error);
                document.getElementById('prompts-grid').innerHTML = `<div class="text-red-500 border border-red-500 p-4">ERRORE: Impossibile leggere prompts.json. Assicurati che il file esista e sia un JSON valido.</div>`;
            }
        }

        function initApp() {
            renderAliases();
            renderPrompts();
            setupEventListeners();
        }

        function renderAliases() {
            const aliases = ['ALL', ...new Set(allPrompts.map(p => p.alias))];
            const container = document.getElementById('alias-container');
            
            container.innerHTML = aliases.map(alias => `
                <button 
                    onclick="setAlias('${alias}')"
                    class="whitespace-nowrap px-3 py-1 text-xs md:text-sm border border-neon/30 hover:bg-neon hover:text-black transition-colors ${currentAlias === alias ? 'bg-neon text-black font-bold' : 'text-neon'}"
                >
                    ${alias.toUpperCase()}
                </button>
            `).join('');
        }

        window.setAlias = (alias) => {
            currentAlias = alias;
            renderAliases();
            renderPrompts();
        };

        function formatPromptText(text) {
            return text.replace(/\[(.*?)\]/g, '<span class="variable-highlight">[$1]</span>');
        }

        function renderPrompts() {
            const grid = document.getElementById('prompts-grid');
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const checkedDifficulties = Array.from(document.querySelectorAll('.diff-checkbox:checked')).map(cb => cb.value);

            const filtered = allPrompts.filter(p => {
                const matchAlias = currentAlias === 'ALL' || p.alias === currentAlias;
                const matchSearch = p.titolo.toLowerCase().includes(searchText) || p.testo.toLowerCase().includes(searchText) || p.tags.includes(searchText);
                const matchDiff = checkedDifficulties.includes(p.difficolta);
                return matchAlias && matchSearch && matchDiff;
            });

            if(filtered.length === 0) {
                grid.innerHTML = '<div class="text-neon/50 text-center col-span-full py-10">> NESSUN RISULTATO TROVATO.</div>';
                return;
            }

            grid.innerHTML = filtered.map((p) => `
                <div class="prompt-card bg-card border border-neon/30 p-4 md:p-5 flex flex-col justify-between cursor-pointer transition-all h-auto md:h-64 relative group active:scale-95"
                     onclick="openModal(${p.id})">
                    
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] uppercase bg-neon/10 text-neon px-2 py-0.5 border border-neon/30">${p.alias}</span>
                            <span class="text-[10px] ${p.difficolta === 'Difficile' ? 'text-red-400' : 'text-neon/60'}">Lvl.${difficultyWeight[p.difficolta]}</span>
                        </div>
                        <h3 class="text-base md:text-lg font-bold leading-tight mb-2 group-hover:underline decoration-neon decoration-2">${p.titolo}</h3>
                        <p class="text-xs text-gray-400 line-clamp-3 font-sans opacity-80">${p.testo.substring(0, 100)}...</p>
                    </div>

                    <div class="mt-4 flex justify-between items-center text-[10px] text-neon/50">
                        <span>#${p.tags.split(',')[0]}</span>
                        <span class="group-hover:translate-x-1 transition-transform">APRI -></span>
                    </div>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            document.getElementById('search-input').addEventListener('input', renderPrompts);
            document.querySelectorAll('.diff-checkbox').forEach(cb => {
                cb.addEventListener('change', renderPrompts);
            });
        }

        // --- MODAL LOGIC ---
        let currentPromptTextRaw = "";

        window.openModal = (id) => {
            const prompt = allPrompts.find(p => p.id === id); 
            if(!prompt) return;

            document.getElementById('modal-title').innerText = prompt.titolo;
            document.getElementById('modal-desc').innerText = `${prompt.alias} // ${prompt.difficolta}`;
            document.getElementById('modal-text').innerHTML = formatPromptText(prompt.testo);
            currentPromptTextRaw = prompt.testo;
            
            const modal = document.getElementById('prompt-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Blocca lo scroll del body quando il modale è aperto
            document.body.style.overflow = 'hidden';
        };

        document.getElementById('close-modal').onclick = () => {
            const modal = document.getElementById('prompt-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = ''; // Ripristina scroll
        };

        // Chiudi se clicchi fuori
        document.getElementById('prompt-modal').onclick = (e) => {
            if(e.target.id === 'prompt-modal') {
                document.getElementById('close-modal').click();
            }
        }

        document.getElementById('copy-btn').onclick = () => {
            navigator.clipboard.writeText(currentPromptTextRaw).then(() => {
                const btn = document.getElementById('copy-btn');
                const originalText = btn.innerHTML;
                
                btn.classList.replace('bg-neon', 'bg-white');
                btn.innerHTML = '<span>COPIATO!</span>';
                
                setTimeout(() => {
                    btn.classList.replace('bg-white', 'bg-neon');
                    btn.innerHTML = originalText;
                }, 2000);
            });
        };

        loadPrompts();

    </script>
</body>
</html>
